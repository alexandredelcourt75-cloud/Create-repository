<!DOCTYPE html>
<html lang="fr"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Carte privée – Membre</title>
<link rel="stylesheet" href="/styles.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<style>#map{height:90vh}</style>
</head><body>
<header><h1>Carte privée</h1></header>
<div id="map"></div>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const map = L.map('map').setView([50.40, 3.50], 11);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'© OSM'}).addTo(map);
fetch('/api/geojson')
  .then(r=>{ if(!r.ok) throw new Error('unauthorized'); return r.json(); })
  .then(data=>{
    const layer = L.geoJSON(data, {
      onEachFeature: (f,l)=> {
        const p=f.properties;
        l.bindPopup(`<b>${p.name}</b><br>Essence: ${p.essence}<br>Période: ${p.saison||''}`);
      }
    }).addTo(map);
    map.fitBounds(layer.getBounds());
  })
  .catch(()=> alert('Accès refusé.'));
</script>
</body></html>
